@model FOS.Shared.KSBComplaintData

@{
    ViewBag.Title = "Wasa Billing - Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>

  
    .table-responsive {
        display: block;
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    .SMS {
        padding: 8px 12px 8px;
        background-color: #ccc;
        color: black;
        opacity: 0.83;
        transition: opacity 0.6s;
        margin-bottom: 15px;
        font-weight: bold;
        width: 240px;
    }
    .MYSMS {
        padding: 8px 12px 8px;
        background-color: #ccc;
        color: black;
        opacity: 0.83;
        transition: opacity 0.6s;
        margin-bottom: 15px;
        font-weight: bold;
        width: 240px;
    }

    #ChildStatus_paginate {
        margin-bottom: 7px;
    }

    .modal-title {
        padding-top: 17px;
        font-size: 21px;
        font-weight: normal;
        line-height: 12px;
        margin: 0;
        padding-bottom: 17px;
        font-family: 'MyriadPro-Regular';
    }


    .grid-container {
        display: grid;
        grid-template-columns: auto auto auto auto;
        padding: 20px;
        background-color: #1969b1;
    }

    .table-bordered th, .table-bordered td {
        border-left: 1px solid #ddd;
        vertical-align: middle;
    }

    .label {
        color: white;
    }

    .grid-item {
        color: white;
    }

    .modal {
        width: 1053px;
        height: auto;
    }
</style>
@*Upload Photo Start*@
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="~/Content/Style/UploadPhoto.css" rel="stylesheet" />
@*Upload Photo END*@
@*Calender for Filter Data START*@
<link href="~/Content/Style/Calender.css" rel="stylesheet" />
@*Calender for Filter Data END*@




<h3 class="page-title"></h3>
<div class="widget-title text-center" style=" background-color: #1969b1;">
    <h4><strong> All Bills Detail</strong></h4><hr style="margin:13px;" />
</div>
<div class="grid-container">
    <div class="grid-item">
        <label>From Date:</label>
        <div class="controls">
            <input class="text-box single-line" id="StartingDate1" autocomplete="off" name="StartingDate1" style="height: 22px; width: 202px; margin-bottom: 0px;" placeholder="DD-MM-YYYY">
        </div>
    </div>
    <div class="grid-item">
        <label>To Date:</label>
        <div class="controls">
            <input class="text-box single-line" id="StartingDate2" autocomplete="off" name="StartingDate2" style="height: 22px; width: 202px; margin-bottom: 0px;" placeholder="DD-MM-YYYY">
        </div>
    </div>
    <div class="grid-item">
        <label>Project:</label>
        <div class="controls" style="margin-left: 0px">
            @Html.DropDownListFor(model => model.ProjectId, new SelectList(Model.Projects, "ID", "Name"), new { @class = "" })
        </div>
    </div>
    <div class="grid-item" style="margin-top: 28px;">
        <button type="submit" id="ApplyFilter" class="btn btn-primary">
            <i class="icon-ok icon-white" style="padding-right: 2px"></i><span style="width:50px"><strong>Apply Filter</strong></span>
        </button>
        @*<button type="submit" id="Clear" class="btn btn-primary">
            <i class="icon-remove icon-white" style="padding-right: 2px"></i><span style="width:50px"><strong>Clear</strong></span>
        </button>
        <button id="StartAutoPagination" class="btn btn-primary">
            <i class="icon-ok icon-white" style="padding-right: 2px"></i><span style="width:50px"><strong> Start AP</strong></span>
        </button>
        <button id="EndAutoPagination" class="btn btn-primary">
            <i class="icon-remove icon-white" style="padding-right: 2px"></i><span style="width:50px"><strong>Stop AP</strong></span>
        </button>*@
    </div>



</div>
<div class="table-responsive">
    <table class="table table-striped table-hover table-bordered" id="datatab">
        <thead>
            <tr class="align-center" style="background-color:#1969b1; color:white;">
                <th>Sr #</th>
                <th>Consumer No</th>
                <th>Consumer Name</th>
                <th>Consumer Address</th>
                <th>DDR</th>
                <th>Ward</th>
                <th>Area</th>
                <th>Launched By</th>
               
              
             
           
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
<div id="myModal" class="modal fade" role="dialog" style="top:7%; display:none;">

    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" style="background-color: #1969b1;">
                <button type="button" class="close" style="color:white;" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="font-weight: 900;color: white;"><strong>View Complaint Detail</strong></h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <div class="span12">
                        <div class="span6" style="border-style: groove; padding: 10px;margin-bottom: 10px;">
                            <div class="span12">
                                <h4 class="modal-title text-center" style="font-weight: 900;color: black; padding-bottom: 0px;"><strong> Actual Complaint's Status</strong></h4>
                                <hr />
                            </div>
                            <div class="span12">

                                <div class="span5" style="margin-left:0px;"><label>Site Code:</label></div>
                                <div class="span7" id="ActualSiteCode" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Site Name:</label></div>
                                <div class="span7" id="ActualSiteName" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Complaint No:</label></div>
                                <div class="span7" id="ActualComplaintNo" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Launch Time:</label></div>
                                <div class="span7" id="ActualLaunchTime" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Launched By:</label></div>
                                <div class="span7" id="ActualLaunchBy" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Fault Type:</label></div>
                                <div class="span7" id="ActualFaultType" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Fault Type Detail:</label></div>
                                <div class="span7" id="ActualFaultTypeDetail" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Complaint Status:</label></div>
                                <div class="span7" id="ActualComplaintStatus" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Contact Person:</label></div>
                                <div class="span7" id="ActualPersonName" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Initial Remarks:</label></div>
                                <div class="span7" id="ActualInitialRemarks" style="margin-left:0px;"></div>

                            </div>
                            <div class="span12">
                                <div class="span6" style="margin-left:0px; margin-bottom:0px; border-style: solid;">
                                    <img src="~/Images/KSB_Logo_New.jpg" style="width:221px; height:215px;" id="ActualPicture1" />
                                </div>
                                <div class="span6" style="margin-left:6px; border-style: solid;">
                                    <img src="~/Images/KSB_Logo_New.jpg" style="width:221px; height:215px;" id="ActualPicture2" />
                                </div>



                            </div>
                        </div>
                        <div class="span6" style="border-style: groove; padding: 10px;margin-bottom: 10px;">
                            <div class="span12">
                                <h4 class="modal-title text-center" style="font-weight: 900;color: black; padding-bottom: 0px;"><strong>Complaint's Current Status</strong></h4>
                                <hr />
                            </div>
                            <div class="span12">

                                <div class="span5" style="margin-left:0px;"><label>Site Code:</label></div>
                                <div class="span7" id="SiteCode" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Site Name:</label></div>
                                <div class="span7" id="SiteName" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Complaint No:</label></div>
                                <div class="span7" id="ComplaintNo" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Launch Time:</label></div>
                                <div class="span7" id="LaunchTime" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Launched By:</label></div>
                                <div class="span7" id="LaunchBy" style="margin-left:0px;"></div>

                                @*<div class="span5" style="margin-left:0px;"><label>Complaint Type:</label></div>
        <div class="span7" id="ComplaintType" style="margin-left:0px;"></div>*@

                                <div class="span5" style="margin-left:0px;"><label>Fault Type:</label></div>
                                <div class="span7" id="FaultType" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Fault Type Detail:</label></div>
                                <div class="span7" id="FaultTypeDetail" style="margin-left:0px;"></div>

                                @*<div class="span5" style="margin-left:0px;"><label>Contact Person:</label></div>
        <div class="span7" id="Name" style="margin-left:0px;"></div>*@

                                @*<div class="span5" style="margin-left:0px;"><label>Initial Remarks:</label></div>
        <div class="span7" id="InitialRemarks" style="margin-left:0px;"></div>*@

                                <div class="span5" style="margin-left:0px;"><label>Complaint Status:</label></div>
                                <div class="span7" id="ComplaintStatus" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Progress Status:</label></div>
                                <div class="span7" id="ProgressStatusName" style="margin-left:0px;"></div>

                                <div class="span5" style="margin-left:0px;"><label>Updated At:</label></div>
                                <div class="span5" id="LastUpdated" style="margin-left:0px;"></div>
                                <div class="span2" style="margin-left:0px;"><i class="fa fa-edit" data-id="209" data-toggle="modal" data-target="#UpdateComplaintTime" style="color:black; font-size:15px;"></i></div>


                                @*<div class="span5" style="margin-left:0px;"><label>Progress Remarks:</label></div>
        <div class="span7" id="ProgressStatusOtherRemarks" style="margin-left:0px;"></div>*@

                            </div>
                            <div class="span12">
                                <div class="span6" style="margin-left:0px; margin-bottom:0px; border-style: solid;">
                                    <img src="~/Images/KSB_Logo_New.jpg" style="width:221px; height:215px;" id="Picture1" />
                                </div>
                                <div class="span6" style="margin-left:6px; border-style: solid;">
                                    <img src="~/Images/KSB_Logo_New.jpg" style="width:221px; height:215px;" id="Picture2" />
                                </div>




                            </div>
                        </div>

                    </div>
                    <div class="span12" style=" margin-left: 0px; border-style: groove;margin-bottom: 20px;">
                        <div class="widget-title text-center" style=" background-color: #1969b1;">
                            <h4><strong>Client Remarks</strong></h4>
                        </div>
                        <table class="table table-striped table-hover table-bordered">
                            <thead>
                                <tr class="align-center" style="background-color:#1969b1; color:white;">
                                    <th style="text-align: center; width: 164px;">Date Time</th>
                                    <th style="text-align: center; width: 164px;">Name</th>
                                    <th style="text-align: center;">Remarks</th>
                                    <th style="text-align: center;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="RemarksData"></tbody>
                        </table>
                    </div>
                    <div class="span12" style=" margin-left: 0px; border-style: groove;margin-bottom: 20px;">
                        <div class="widget-title text-center" style=" background-color: #1969b1;">
                            <h4><strong>Progress Detail</strong></h4>
                        </div>
                        <table class="table table-striped table-hover table-bordered">
                            <thead>
                                <tr class="align-center" style="background-color:#1969b1; color:white;">
                                    <th style="text-align: center;">Date Time</th>
                                    <th style="text-align: center;">Fault Type/Fault Type Detail</th>
                                    <th style="text-align: center;">Complaint Status</th>
                                    <th style="text-align: center;">Assigned FS</th>
                                    <th style="text-align: center;">Progress Status</th>
                                    <th style="text-align: center;">Progress Remarks</th>
                                    <th style="text-align: center; width:131px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ChildStatus"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@*<div id="AddRemarksModel" class="modal fade" role="dialog" style="top:35%; -webkit-border-radius: 0px; left:35%; width:430px; display:none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #1969b1;">
                <button type="button" class="close" style="color:white;" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="font-weight: 900;color: white;"><strong>Add Remarks</strong></h4>
            </div>
            <div class="modal-body" style="padding: 12px 23px 40px;">
                <div class="form-group">
                    <div class="control-group">
                        <label class="control-label">Remarks:*</label>
                        <div class="controls">
                            <div class="span12">
                                <div class="span12">
                                    <input class="hidden" id="ComplaintIdAddRemark" />
                                    <textarea cols="20" id="AddRemark" name="AddRemark" placeholder="Enter Remarks:" rows="2" style="height:100px; width:370px; margin: 0px 0px 10px;"></textarea>
                                </div>
                                <div class="span12">
                                    <div class="control-group text-center" style="margin-top: 4px;">
                                        <button class="btn btn-primary"><i class="icon-ok icon-white"></i><span onclick="AddRemarksCreate()"> Add</span></button>
                                        <button type="button" id="ResetRemarks" class="btn btn-info"><i class="icon-ban-circle icon-white"></i><span></span> Reset</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>*@
@*<div id="ChatBoxModel" class="modal fade" role="dialog" style="top:35%; -webkit-border-radius: 0px; left:35%; width:430px; display:none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #1969b1;">
                <button type="button" class="close" style="color:white;" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="font-weight: 900;color: white;" id="SiteNamePlusCode"></h4>
            </div>
            <div class="modal-body" style="padding: 12px 23px 40px;">
                <div class="form-group">
                    <div class="control-group">
                        <div class="controls">
                            <div class="span12" id="GetSMS" style=" overflow-y: scroll; height: 250px;">

                            </div>
                            <div class="span12">
                                <div class="span6">
                                    <input class="hidden" id="SendSMSComplaintId" />
                                    <input type="text" autocomplete="off" placeholder="Enter Message.." style="width:300px;" id="ComplaintSMS" />

                                </div>
                                <div class="span6">
                                    <div class="control-group text-center" style="float:right;">
                                        <button class="btn btn-primary" style=" padding: 6px 6px 4px 6px"><i class="icon-ok icon-white"></i><span onclick="SendSMS()"><strong> Send</strong></span></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>*@
@*<div id="UpdateComplaintTime" class="modal fade" role="dialog" style="top:35%; -webkit-border-radius: 0px; left:35%; width:430px; display:none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #1969b1;">
                <button type="button" class="close" style="color:white;" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="font-weight: 900;color: white;"><strong>Update Complaint's Time</strong></h4>
            </div>
            <div class="modal-body" style="padding: 12px 23px 40px;">
                <div class="form-group">
                    <div class="control-group">
                        <label class="control-label">Updated At:*</label>
                        <div class="controls">
                            <div class="span12">
                                <div class="span12">
                                    <input type="datetime-local" id="UpdateDateTime" style="width:370px;">
                                    <input type="text" class="hidden" id="UpdateDateTimeComplaintID" style="width:370px;">

                                </div>
                                <div class="span12">
                                    <div class="control-group text-center" style="margin-top: 4px;">
                                        <button class="btn btn-primary"><i class="icon-ok icon-white"></i><span onclick="UpdateDateTime()"> Update</span></button>
                                        <button type="button" id="ResetUpdateDateTime" class="btn btn-info"><i class="icon-ban-circle icon-white"></i><span></span> Reset</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>*@

@*<div id="UpdateComplaint" class="modal fade" role="dialog" style="top:7%; display:none; width: 1052px;">

    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #1969b1;">
                <button type="button" class="close" style="color:white;" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="font-weight: 900;color: white;"><strong>Update Complaint</strong></h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <div class="span12">
                        <div class="span3" style="margin-top: 0px;">
                            <div class="control-group" style="margin-bottom: 10px">
                                <input id="UpdateComplaintID" name="UpdateComplaintID" class="hidden" type="text" value="">
                                <label class="control-label">Fault Type:*</label>
                                <div class="controls" style="margin-left: 0px">
                                    @Html.DropDownListFor(model => model.UpdateFaulttypeId, new SelectList(Model.faultTypes, "Id", "Name"), new { @class = "Areas" })
                                </div>
                            </div>
                            <div class="control-group" style="margin-bottom: 10px">
                                <label class="control-label">Fault Type Detail:</label>
                                <div class="controls" style="margin-left: 0px">
                                    @Html.DropDownListFor(model => model.UpdateFaulttypeDetailId, new SelectList(Model.faultTypesDetail, "Id", "Name"), new { @class = "Areas" })

                                </div>
                            </div>
                            <div class="control-group " style="margin-bottom: 20px" id="UpdateFaultTypeDetailOtherRemarksBox">
                                <label class="control-label" style="">Fault Type Detail Other Remarks:</label>
                                <div class="controls" style="margin-left: 0px">
                                    @Html.EditorFor(model => model.UpdateFaultTypeDetailOtherRemarks)
                                </div>
                            </div>
                            <div class="control-group" style="margin-bottom: 10px">
                                <label class="control-label">Priority:</label>
                                <div class="controls" style="margin-left: 0px">
                                    @Html.DropDownListFor(model => model.UpdatePriorityId, new SelectList(Model.priorityDatas, "ID", "Name"), new { @class = "Areas" })
                                </div>
                            </div>
                            <div class="control-group" style="margin-bottom: 10px">
                                <label class="control-label">Complaint Type:</label>
                                <div class="controls" style="margin-left: 0px">
                                    @Html.DropDownListFor(model => model.UpdateComplaintTypeID, new SelectList(Model.ComplaintTypes, "ID", "Name"), new { @class = "Areas" })
                                </div>
                            </div>
                            <div class="control-group" style="margin-bottom: 10px">
                                <label class="control-label">Assign FS: </label>
                                <div class="controls" style="margin-left: 0px">
                                    @Html.DropDownListFor(model => model.UpdateSalesOficerID, new SelectList(Model.FieldOfficers, "ID", "Name"), new { @class = "Areas" })
                                </div>
                            </div>
                        </div>
                        <div class="span3" style="margin-top: 0px;">
                            <div class="control-group" style="margin-bottom: 10px">
                                <label class="control-label">Complaint Status:</label>
                                <div class="controls" style="margin-left: 0px">
                                    @Html.DropDownListFor(model => model.UpdateStatusID, new SelectList(Model.complaintStatuses, "ID", "Name"), new { @class = "Areas", @Value = "2003" })
                                </div>
                            </div>
                            <div class="control-group" style="margin-bottom: 10px">
                                <label class="control-label">Progress Status:</label>
                                <div class="controls" style="margin-left: 0px">
                                    @Html.DropDownListFor(model => model.UpdateProgressStatusId, new SelectList(Model.ProgressStatus, "ID", "Name"), new { @class = "Areas" })
                                </div>
                            </div>
                            <div class="control-group" style="margin-bottom: 10px" id="UpdateProgressStatusOtherRemarksBox">
                                <label class="control-label" style="">Progress Status Others Remarks:</label>
                                <div class="controls" style="margin-left: 0px">
                                    @Html.EditorFor(model => model.UpdateProgressStatusOtherRemarks)
                                </div>
                            </div>
                            <div class="control-group " style="margin-bottom: 10px;">
                                <label class="control-label" style="">Timeline for resolution:</label>
                                <select class="Areas" id="UpdateTime" name="UpdateTime">
                                    <option selected value="0">--Select Time For Resolution--</option>
                                </select>
                            </div>
                            <div class="control-group" style="margin-bottom: 20px">
                                <label class="control-label" style="">Person Name:</label>
                                <div class="controls" style="margin-left: 0px">
                                    @Html.TextBoxFor(model => model.UpdatePerson, new { placeholder = "Enter Contact Person Name:" })
                                </div>
                            </div>
                            <div class="control-group" style="margin-bottom: 10px;">
                                <label class="control-label" style="">Complaint Progress Remarks:</label>
                                <div class="controls" style="margin-left: 0px">
                                    @Html.TextAreaFor(model => model.UpdateProgressRemarks, new { @style = "height:22px; width:202px; margin: 0px 0px 10px;", placeholder = "Enter Progress Remarks:" })
                                </div>
                            </div>
                        </div>
                        <div class="span3" style="margin-top: 0px;">
                            <div class="user-profile-image">
                                <input type="file" name="UpdatePicture1" style="display:none" ; class="hidden" id="UpdatePicture1" />
                                <img src="/Images/KSB_Logo_New.jpg" class="img-responsive" id="UpdatePicture1UserImage" />
                                <div class="upload-photo" style="width:230px;bottom:-310px;" id="UpdateUploadPicture1">
                                    <img src="/Images/upload.png" class="img-responsive" />
                                </div>
                                <div class="remove-photo" style="top:21px;right:304px;" id="UpdateRemovePicture1">
                                    <span class="fa fa-window-close"></span>
                                </div>
                            </div>
                        </div>
                        <div class="span3" style="margin-top: 0px;">
                            <div class="user-profile-image">
                                <input type="file" name="UpdatePicture2" style="display:none" ; class="hidden" id="UpdatePicture2" />
                                <img src="/Images/KSB_Logo_New.jpg" class="img-responsive" id="UpdatePicture2UserImage" />
                                <div class="upload-photo" style="width:230px;bottom:-310px;" id="UpdateUploadPicture2">
                                    <img src="/Images/upload.png" class="img-responsive" />
                                </div>
                                <div class="remove-photo" id="UpdateRemovePicture2" style="top:21px;right:56px;">
                                    <span class="fa fa-window-close"></span>
                                </div>
                            </div>
                        </div>
                        <div class="control-group" style="margin-top: 10px">
                            <div style="padding-left: 0px;  margin-top: 16px;">
                                <button  class="btn btn-primary" onclick="PostUpdateComplaint()" style="margin-top: 50px;margin-left: 208px;width: 100px;">
                                    <strong><i class="icon-ok icon-white"></i> Update</strong>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>*@

<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>

<script>


    $(document).ready(function () {

     



        //Get Update Complaint Start
        $("#UpdateFaultTypeDetailOtherRemarksBox").hide();
        $("#UpdateProgressStatusOtherRemarksBox").hide();
        $("#EditOtherRemarksBox").hide();
        $("#EditProgressStatusOtherRemarksBox").hide();
        for (var a = 1; a < 201; a++) {
            var divHtml = '<option value="' + a + '">' + a + '</option>'
            $("#UpdateTime").append(divHtml);
        }
        for (var a = 1; a < 201; a++) {
            var divHtml = '<option value="' + a + '">' + a + '</option>'
            $("#EditTime").append(divHtml);
        }
        //Get Update Complaint END

        GenerateDetailGrid();




          //Calender Start
        $('input[name=StartingDate1]').css({ "height": "22px", "width": "202px", "margin-bottom": "0px" });
        $('input[name=StartingDate1]').datepicker({ dateFormat: "dd-MM-yy" });
        $("input[name=StartingDate1]").trigger('change');

        $('input[name=StartingDate2]').css({ "height": "22px", "width": "202px", "margin-bottom": "0px" });
        $('input[name=StartingDate2]').datepicker({ dateFormat: "dd-MM-yy" });
        $("input[name=StartingDate2]").trigger('change');
         //Calender END

    });

    //Detail Start
    function Detail(ComplaintID) {
        $("#myModal").modal();

            var ComplaintID = (ComplaintID);
                    $.ajax({
                        type: "GET",
                        url: "@Url.Action("GetActualComplaintDetail", "Complaint")",
                        data: { ComplaintId: ComplaintID },
                        success: function (Response)
             {
                            $("#ActualSiteCode").html(Response.SiteCode);
                            $("#ActualSiteName").html(Response.SiteName);
                            $("#ActualComplaintNo").html(Response.TicketNo);
                            $("#ActualLaunchTime").html(Response.CreatedDate);
                            $("#ActualLaunchBy").html(Response.LaunchedByName);
                            $("#ActualFaultType").html(Response.FaultTypeName);
                            $("#ActualFaultTypeDetail").html(Response.FaultTypesDetailName);
                            $("#ActualPersonName").html(Response.Name);
                            $("#ActualInitialRemarks").html(Response.Remarks);
                            $("#ActualComplaintStatus").html(Response.StatusName);
                            if (Response.Picture1 == "" || Response.Picture1 == null || Response.Picture1 == "null")
                            {
                                $("#ActualPicture1").attr('src', "/Images/KSB_Logo_New.jpg");
                            }
                            else {
                                $("#ActualPicture1").attr('src', Response.Picture1);
                            }
                            if (Response.Picture2 == "" || Response.Picture2 == null || Response.Picture2 == "null")
                            {
                                $("#ActualPicture2").attr('src', "/Images/KSB_Logo_New.jpg");

                            }
                            else
                            {
                                $("#ActualPicture2").attr('src', Response.Picture2);

                            }
            }
                    });
                    $.ajax({
                        type: "GET",
                        url: "@Url.Action("GetCurrentComplaintDetail", "Complaint")",
                        data: { ComplaintId: ComplaintID },
                        success: function (Response)
             {
                            $("#myModal").css("display", "block");
                            $("#UpdateDateTimeComplaintID").val(Response.ID);
                            $("#SiteCode").html(Response.SiteCode);
                            $("#SiteName").html(Response.SiteName);
                            $("#ComplaintNo").html(Response.TicketNo);
                            $("#LaunchTime").html(Response.CreatedDate);
                            $("#LaunchBy").html(Response.LaunchedByName);
                            $("#FaultType").html(Response.FaultTypeName);
                            if (Response.FaultTypesDetailName == null || Response.FaultTypesDetailName == "") {
                                $("#FaultTypeDetail").html("null");
                            }
                            else
                            {
                                $("#FaultTypeDetail").html(Response.FaultTypesDetailName);
                            }
                            $("#ComplaintStatus").html(Response.StatusName);
                            if (Response.ProgressStatusName == null || Response.ProgressStatusName == "")
                            {
                                $("#ProgressStatusName").html("null");
                            }
                            else {
                                $("#ProgressStatusName").html(Response.ProgressStatusName);
                            }
                            if (Response.LastUpdated == null || Response.LastUpdated == "")
                            {
                                $("#LastUpdated").html("null");
                            }
                            else {
                                $("#LastUpdated").html(Response.LastUpdated);
                            }
                            //$("#ProgressStatusOtherRemarks").html(Response.ProgressStatusOtherRemarks);
                            //$("#Name").html(Response.Name);
                            //$("#InitialRemarks").html(Response.Remarks);
                            //$("#ComplaintType").html(Response.ComplaintType);
                            if (Response.Picture1 != null)
                            {
                                $("#Picture1").attr('src',Response.Picture1);
                            }
                            else
                            {
                                $("#Picture1").attr('src', "/Images/KSB_Logo_New.jpg");
                            }
                            if (Response.Picture2 != null)
                            {
                                $("#Picture2").attr('src',Response.Picture2);
                             }
                            else
                            {
                                $("#Picture2").attr('src', "/Images/KSB_Logo_New.jpg");
                            }
            }
                    });
                    $.ajax({
                        type: "POST",
                        data: { ComplaintId: ComplaintID },
                        url: "@Url.Action("GetComplaintClientRemarks", "Complaint")",
                        dataType: 'JSON',
                        success: function (Response)
                        {
                            $("#RemarksData").empty();
                            if (Response.length == 0)
                            {
                                var divHtml1 = $('<tr>').html("<td style='text-align:center;' colspan='3'>" + "<strong>No Any Client Remark Found Against This complaint</strong>" + "</td>");

                                $("#RemarksData").append(divHtml1);
                            }
                            else
                            {
                                $.each(Response, function (i, item) {
                                    var divHtml = $('<tr>').html("<td style='text-align:center;'>" + item.DateTime + "</td><td style='text-align:center;'>" + item.RemarksByName + "</td><td style='text-align:center;'>" + item.ClientRemarks + "</td><td style='text-align:center;'>" + "<a href='#' class='btn text-center' style='background-color:#1969b1; margin-right:5px; margin-bottom:5px; color:white;' onclick='RemarksDelete(" + item.ID + ")' ><b>Delete</b></td>");
                                    $("#RemarksData").append(divHtml);
                                });
                            }
                        }

                    });
                    $.ajax({
                        type: "POST",
                        data: { ComplaintId: ComplaintID },
                        url: "@Url.Action("GetComplaintChildDataForKSB", "Complaint")",
                        dataType: 'JSON',
                        success: function (Response)
                        {
                            $("#ChildStatus").empty();
                            $.each(Response, function (i, item) {
                                var RoleID = @HttpContext.Current.Session["RoleID"];
                                if (RoleID == 1 || RoleID == 3)
                                {
                                    var divHtml = $('<tr>').html("<td style='text-align:center;'>" + item.DateTime + "</td><td style='text-align:center;'>" + item.FaultTypeFinalName + "</td><td style='text-align:center;'>" + item.ComplaintStatus + "</td><td style='text-align:center;'>" + item.AssignedFS + "</td><td style='text-align:center;'>" + item.ProgressStatusName + "</td><td style='text-align:center;'>" + item.ProgressRemarks + "</td><td style='text-align:center;'>" + "<a href='#' class='btn text-center' style='background-color:#1969b1; margin-right:5px; margin-bottom:5px; color:white;' onclick='ChildView(" + item.ProgressID + ")' ><b>View</b></a>" + "</td>");

                                }
                                else
                                {

                                    if (item.IsPublish == 0) {
                                        var divHtml = $('<tr>').html("<td style='text-align:center;'>" + item.DateTime + "</td><td style='text-align:center;'>" + item.FaultTypeFinalName + "</td><td style='text-align:center;'>" + item.ComplaintStatus + "</td><td style='text-align:center;'>" + item.AssignedFS + "</td><td style='text-align:center;'>" + item.ProgressStatusName + "</td><td style='text-align:center;'>" + item.ProgressRemarks + "</td><td style='text-align:center;'>" + "<a href='#' class='btn text-center' style='background-color:#1969b1; margin-right:5px; margin-bottom:5px; color:white;' onclick='ChildView(" + item.ProgressID + ")' ><b>View</b></a><a href='#' class='btn text-center' style='background-color:#1969b1; color:white;margin-bottom:5px; margin-right:5px; ' onclick='ChildEdit(" + item.ProgressID + ',' + item.ComplaintID + ',' + item.ComplaintStatusID + ")' ><b>Edit</b></a><a href='#' class='btn text-center' style='background-color:#1969b1; margin-right:5px; color:white;margin-bottom:5px; ' onclick='ChildDelete(" + item.ProgressID + ")' ><b>Delete</b></a><a href='#' class='btn text-center' style='background-color:#1969b1;margin-right:5px; color:white;margin-bottom:5px; ' onclick='ChildPublish(" + item.ProgressID + ")' ><b>Publish</b></a>" + "</td>");
                                    }
                                    else {
                                        var divHtml = $('<tr>').html("<td style='text-align:center;'>" + item.DateTime + "</td><td style='text-align:center;'>" + item.FaultTypeFinalName + "</td><td style='text-align:center;'>" + item.ComplaintStatus + "</td><td style='text-align:center;'>" + item.AssignedFS + "</td><td style='text-align:center;'>" + item.ProgressStatusName + "</td><td style='text-align:center;'>" + item.ProgressRemarks + "</td><td style='text-align:center;'>" + "<a href='#' class='btn text-center' style='background-color:#1969b1; margin-right:5px; margin-bottom:5px; color:white;' onclick='ChildView(" + item.ProgressID + ")' ><b>View</b></a><a href='#' class='btn text-center' style='background-color:#1969b1; color:white;margin-bottom:5px; margin-right:5px; ' onclick='ChildEdit(" + item.ProgressID + ',' + item.ComplaintID + ',' + item.ComplaintStatusID + ")' ><b>Edit</b></a><a href='#' class='btn text-center' style='background-color:#1969b1; margin-right:5px; color:white;margin-bottom:5px; ' onclick='ChildDelete(" + item.ProgressID + ")' ><b>Delete</b></a></td>");
                                    }
                                }
                                    $("#ChildStatus").append(divHtml);
                                });

                        }

                    });
                    $('html, body').animate({
                        scrollTop: $("#main-content").offset().top
                    }, 500);

    }
    //Detail END

    //Get Update Complaint Start
    function UpdateComplaint(ComplaintID,ComplaintStatusID) {
        GetUpdateLoadFaultTypeDetails(ComplaintID);
        if (ComplaintStatusID == 3)
        {
            GetUpdateWorkDoneStatusDetails(ComplaintID);
        }
        else
        {
            GetUpdateLoadProgressStatusDetails(ComplaintID);
        }
        $('html, body').animate({
            scrollTop: $("#main-content").offset().top
        }, 500);
        $("#UpdateComplaint").modal();
        $("#ComplaintID").val(ComplaintID);
        var url = "/Complaint/GetUpdateComplaint?ComplaintID=" + ComplaintID;
        $.ajax({
            type: "GET",
            url: url,
            success: function (Response) {
                $("#UpdateComplaintID").val(Response.UpdateComplaintID);
                $("#UpdateFaulttypeId").val(Response.UpdateFaulttypeId);
                $("#UpdateFaulttypeDetailId").val(Response.UpdateFaulttypeDetailId);
                if (Response.UpdateFaulttypeDetailId == 3030 || Response.UpdateFaulttypeDetailId == 3042 || Response.UpdateFaulttypeDetailId == 3049) {
                    $("#UpdateFaultTypeDetailOtherRemarksBox").show();
                    $("#UpdateFaultTypeDetailOtherRemarks").show();
                }
                $("#UpdateFaultTypeDetailOtherRemarks").val(Response.UpdateFaultTypeDetailOtherRemarks);
                $("#UpdatePriorityId").val(Response.UpdatePriorityId);
                $("#UpdateComplaintTypeID").val(Response.UpdateComplaintTypeID);
                $("#UpdateSalesOficerID").val(Response.UpdateSalesOficerID);
                $("#UpdateStatusID").val(Response.UpdateStatusID);
                $("#UpdateProgressStatusId").val(Response.UpdateProgressStatusId);
                if (Response.UpdateProgressStatusId == 2018 || Response.UpdateProgressStatusId == 2031 || Response.UpdateProgressStatusId == 2035) {
                    $("#UpdateProgressStatusOtherRemarksBox").show();
                    $("#UpdateProgressStatusOtherRemarks").show();
                }
                $("#UpdateProgressStatusOtherRemarks").val(Response.UpdateProgressStatusOtherRemarks);
                $("#UpdateTime").val(Response.ReslovedHours);
                $("#UpdatePerson").val(Response.UpdatePerson);
            }
        })
    }
    function GetUpdateLoadFaultTypeDetails(ComplaintID)
    {
        var ClientID = ComplaintID ;
        $.ajax({
            type: "POST",
            url: "@Url.Action("GetFaultTypeDetailListForFaulttypeID", "Complaint")",
            data: { ClientID: ClientID},
            success: function (json) {

                var $el = $("#UpdateFaulttypeDetailId");
                $el.empty(); // remove old options
                $.each(json, function (value, key) {
                    $el.append($("<option></option>").val(key.ID).text(key.Name));
                });


            }
        });
    }
    function GetUpdateLoadProgressStatusDetails(ComplaintID)
    {
        var ClientID = ComplaintID ;
        $.ajax({
            type: "POST",
            url: "@Url.Action("GetUpdateProgressStatusListForFaulttypeID", "Complaint")",
            data: { ClientID: ClientID},
            success: function (json) {

                var $el = $("#UpdateProgressStatusId");
                $el.empty(); // remove old options
                $.each(json, function (value, key) {
                    $el.append($("<option></option>").val(key.ID).text(key.Name));
                });


            }
        });
    }
    function GetUpdateWorkDoneStatusDetails(ComplaintID)
    {
        var ClientID = ComplaintID ;
        $.ajax({
            type: "POST",
            url: "@Url.Action("GetWorkDoneStatusListForFaulttypeID", "Complaint")",
            data: { ClientID: ClientID},
            success: function (json) {

                var $el = $("#UpdateProgressStatusId");
                $el.empty(); // remove old options
                $.each(json, function (value, key) {
                    $el.append($("<option></option>").val(key.ID).text(key.Name));
                });


            }
        });
    }

    $("#UpdateFaulttypeId").change(function () {
        UpdateLoadFaultTypeDetails();
        UpdateLoadProgressStatusDetails();
    });
    $("#UpdateFaulttypeDetailId").change(function () {
        if ($("#UpdateFaulttypeDetailId").val() == '3030') {
            $("#UpdateFaultTypeDetailOtherRemarksBox").show();
        }
        else if ($("#UpdateFaulttypeDetailId").val() == '3042') {
            $("#UpdateFaultTypeDetailOtherRemarksBox").show();
        }
        else if ($("#UpdateFaulttypeDetailId").val() == '3049') {
            $("#UpdateFaultTypeDetailOtherRemarksBox").show();
        }
        else
        {
            $("#UpdateFaultTypeDetailOtherRemarksBox").hide();
        }
    });
    $("#UpdateProgressStatusId").change(function () {
        if ($("#UpdateProgressStatusId").val() == '2018') {
            $("#UpdateProgressStatusOtherRemarksBox").show();
        }
        else if ($("#UpdateProgressStatusId").val() == '2031') {
            $("#UpdateProgressStatusOtherRemarksBox").show();
        }
        else if ($("#UpdateProgressStatusId").val() == '2035') {
            $("#UpdateProgressStatusOtherRemarksBox").show();
        }
        else {
            $("#UpdateProgressStatusOtherRemarksBox").hide();
        }
    });
    $("#UpdateStatusID").change(function () {
        if ($("#UpdateStatusID").val() == '3')
            {
                UpdateWorkDoneStatusDetails();
            }
            else
            {
                UpdateLoadProgressStatusDetails();
            }
    });
    function UpdateLoadFaultTypeDetails() {
        var ClientID = $("#UpdateFaulttypeId").val();
        $.ajax({
            type: "POST",
            url: "@Url.Action("GetFaultTypeDetailList", "Complaint")",
            data: { ClientID: ClientID},
            success: function (json) {

                var $el = $("#UpdateFaulttypeDetailId");
                $el.empty(); // remove old options
                $.each(json, function (value, key) {
                    $el.append($("<option></option>").val(key.ID).text(key.Name));
                });


            }
        });
    }
    function UpdateLoadProgressStatusDetails() {
        var ClientID = $("#UpdateFaulttypeId").val();

        $.ajax({
            type: "POST",
            url: "@Url.Action("GetProgressDetailList", "Complaint")",
            data: { ClientID: ClientID},
            success: function (json) {

                var $el = $("#UpdateProgressStatusId");
                $el.empty(); // remove old options
                $.each(json, function (value, key) {
                    $el.append($("<option></option>").val(key.ID).text(key.Name));
                });


            }
        });
        }
    function UpdateWorkDoneStatusDetails() {
        var ClientID = $("#UpdateFaulttypeId").val();
         $.ajax({
            type: "POST",
            url: "@Url.Action("WorkDoneDetailList", "Complaint")",
             data: { ClientID: ClientID },
            success: function (json) {

                var $el = $("#UpdateProgressStatusId");
                $el.empty(); // remove old options
                $.each(json, function (value, key) {
                    $el.append($("<option></option>").val(key.ID).text(key.Name));
                });


            }
        });
    }


    //Upload-Picture1 Start
    $('#UpdatePicture1UserImage').click(function () {
        $('#UpdatePicture1').trigger('click');
    });
    $('#UpdateUploadPicture1').click(function () {
        $('#UpdatePicture1').trigger('click');
    });
    $('#UpdatePicture1').change(function ()
    {
        if (this.files && this.files[0]) {
            var fileReader = new FileReader();
            fileReader.readAsDataURL(this.files[0]);
            fileReader.onload = function (x) {
                $('#UpdatePicture1UserImage').attr('src', x.target.result);

            }
        }

    });
    $('#UpdateRemovePicture1').click(function ()
    {
        $('#UpdatePicture1UserImage').attr('src', "/Images/KSB_Logo_New.jpg");
        $('#UpdatePicture1').val("");
    });
    //Upload-Picture1 End

    //Upload-Picture2 Start
    $('#UpdatePicture2UserImage').click(function () {
        UploadClickEvent2();
    });
    $('#UpdateUploadPicture2').click(function () {
        UploadClickEvent2();
    });
    function UploadClickEvent2() {
        $('#UpdatePicture2').trigger('click');
    }
    $('#UpdatePicture2').change(function () {
        if (this.files && this.files[0]) {
            var fileReader = new FileReader();
            fileReader.readAsDataURL(this.files[0]);
            fileReader.onload = function (x) {
                $('#UpdatePicture2UserImage').attr('src', x.target.result);

            }
        }

    });
    $('#UpdateRemovePicture2').click(function () {
        $('#UpdatePicture2UserImage').attr('src', "/Images/KSB_Logo_New.jpg");
        $('#UpdatePicture2').val("");


    });
    //Upload-Picture2 End
    //Get Update Complaint END


    // Post Update  Complaint Start
    function PostUpdateComplaint() {
        var data = new FormData();
        var files = $("#UpdatePicture1").get(0).files;
        if (files.length > 0) {
            data.append("UpdatePicture1", files[0]);
        }
        var files2 = $("#UpdatePicture2").get(0).files;
        if (files2.length > 0) {
            console.log(files2[0]);
            data.append("UpdatePicture2", files2[0]);
        }
        var RoleID = "@HttpContext.Current.Session["RoleID"]";
        data.append("RoleID", RoleID );
        data.append("UpdateComplaintID", $("#UpdateComplaintID").val());
        data.append("UpdateFaulttypeId", $("#UpdateFaulttypeId").val());
        data.append("UpdateFaulttypeDetailId", $("#UpdateFaulttypeDetailId").val());
        data.append("UpdateFaultTypeDetailOtherRemarks", $("#UpdateFaultTypeDetailOtherRemarks").val());
        data.append("UpdatePriorityId", $("#UpdatePriorityId").val());
        data.append("UpdateComplaintTypeID", $("#UpdateComplaintTypeID").val());
        data.append("UpdateSalesOficerID", $("#UpdateSalesOficerID").val());
        data.append("UpdateStatusID", $("#UpdateStatusID").val());
        data.append("UpdateProgressStatusId", $("#UpdateProgressStatusId").val());
        data.append("UpdateProgressStatusOtherRemarks", $("#UpdateProgressStatusOtherRemarks").val());
        data.append("UpdateTime", $("#UpdateTime").val());
        data.append("UpdatePerson", $("#UpdatePerson").val());
        data.append("UpdateProgressRemarks", $("#UpdateProgressRemarks").val());
        data.append("UpdatePicture1", $("#UpdatePicture1").val());
        data.append("UpdatePicture2", $("#UpdatePicture2").val());
        $.ajax({
            type: "Post",
            url: "/Home/PostUpdateComplaint",
            contentType: false,
            processData: false,
            cache: false,
            data: data,
            success: function (result) {
                if (result == true)
                {
                    $('#UpdateComplaint').modal('hide');
                    alertify.success("Complaint Status Updated Successfully.");
                    $('#UpdateProgressRemarks').val("");
                    $('#UpdateComplaintID').val(0);
                    $('#UpdateFaulttypeId').val(0);
                    $('#UpdateFaulttypeDetailId').val(0);
                    $('#UpdateFaultTypeDetailOtherRemarks').val("");
                    $('#UpdatePriorityId').val(0);
                    $('#UpdateComplaintTypeID').val(0);
                    $('#UpdateSalesOficerID').val(0);
                    $('#UpdateStatusID').val(0);
                    $('#UpdateProgressStatusId').val(0);
                    $('#UpdateProgressStatusOtherRemarks').val("");
                    $('#UpdateTime').val(0);
                    $('#UpdatePerson').val("");
                    $('#UpdatePicture1').val("");
                    $('#UpdatePicture2').val("");
                    $("#UpdatePicture2UserImage").attr('src', "/Images/KSB_Logo_New.jpg");
                    $("#UpdatePicture1UserImage").attr('src', "/Images/KSB_Logo_New.jpg");
                    $("#UpdateFaultTypeDetailOtherRemarksBox").hide();
                    $("#UpdateProgressStatusOtherRemarksBox").hide();
                    $("#EditOtherRemarksBox").hide();
                    $("#EditProgressStatusOtherRemarksBox").hide();
                    $('#datatab').DataTable().ajax.reload();
                }
            }
        })

    }
    // Post Update Complaint Start END


    //Get Edit Complaint Start
    function ChildEdit(ProgressChildID, ComplaintID, ComplaintStatusID) {
        GetEditLoadFaultTypeDetails(ComplaintID);
        if (ComplaintStatusID == 3)
        {
            EditWorkDoneStatusDetails(ComplaintID);
        }
        else
        {
            GetEditLoadProgressStatusDetails(ComplaintID);
        }
        $('html, body').animate({
            scrollTop: $("#main-content").offset().top
        }, 500);
        $("#EditChildRecord").modal();
        var url = "/Complaint/GetEditComplaint?ProgressChildID=" + ProgressChildID;
        $.ajax({
            type: "GET",
            url: url,
            success: function (Response)
            {

                $("#ProgressChildID").val(Response.ProgressChildID);
                $("#EditComplaintID").val(Response.ComplaintID);
                $("#JobDetailID").val(Response.JobDetailID);
                $("#EditFaulttypeId").val(Response.FaultTypeID);
                $("#EditDateTime").val(Response.EditDateTime);
                $("#EditFaulttypeDetailId").val(Response.FaultTypeDetailID);
                if (Response.EditFaulttypeDetailId == 3030 || Response.EditFaulttypeDetailId == 3042 || Response.EditFaulttypeDetailId == 3049)
                {
                    $("#EditOtherRemarksBox").show();
                }
                $("#EditFaultTypeDetailOtherRemarks").val(Response.FaultTypeDetailRemarks);
                $("#EditPriorityId").val(Response.PriorityID);
                $("#EditComplaintTypeID").val(Response.ComplaintTypeID);
                $("#EditSalesOficerID").val(Response.AssignedFSID);
                $("#EditStatusID").val(Response.ComplaintStatusID);
                $("#EditProgressStatusId").val(Response.ProgressStatusID);
                if (Response.EditProgressStatusId == 2018 || Response.EditProgressStatusId == 2031 || Response.EditProgressStatusId == 2035)
                {
                    $("#EditProgressStatusOtherRemarksBox").show();
                }
                $("#EditProgressStatusOtherRemarks").val(Response.ProgressStatusOtherRemarks);
                $("#EditTime").val(Response.EditTime);
                $("#EditName").val(Response.EditPerson);
                $("#EditRemarks").val(Response.ProgressRemarks);
                if (Response.Picture1 != null) {
                    $("#ChildEditUserImage").attr('src', Response.Picture1);
                    $("#ChildEditPicture1").val(Response.Picture1);
                }
                else
                {
                    $("#ChildEditUserImage").attr('src', "/Images/KSB_Logo_New.jpg");
                }
                if (Response.Picture2 != null) {
                    $("#ChildEditUserImage2").attr('src', Response.Picture2);
                    $("#ChildEditPicture2").val(Response.Picture2);

                }
                else {
                    $("#ChildEditUserImage2").attr('src', "/Images/KSB_Logo_New.jpg");
                }
            }
        })
    }
    function GetEditLoadFaultTypeDetails(ComplaintID)
    {
        var ClientID = ComplaintID ;
        $.ajax({
            type: "POST",
            url: "@Url.Action("GetFaultTypeDetailListForFaulttypeID", "Complaint")",
            data: { ClientID: ClientID},
            success: function (json) {

                var $el = $("#EditFaulttypeDetailId");
                $el.empty(); // remove old options
                $.each(json, function (value, key) {
                    $el.append($("<option></option>").val(key.ID).text(key.Name));
                });


            }
        });
    }
    function GetEditLoadProgressStatusDetails(ComplaintID)
    {
        var ClientID = ComplaintID ;
        $.ajax({
            type: "POST",
            url: "@Url.Action("GetUpdateProgressStatusListForFaulttypeID", "Complaint")",
            data: { ClientID: ClientID},
            success: function (json) {

                var $el = $("#EditProgressStatusId");
                $el.empty(); // remove old options
                $.each(json, function (value, key) {
                    $el.append($("<option></option>").val(key.ID).text(key.Name));
                });


            }
        });
    }
    function EditWorkDoneStatusDetails(ComplaintID) {
        var ClientID = ComplaintID;
         $.ajax({
            type: "POST",
            url: "@Url.Action("GetWorkDoneStatusListForFaulttypeID", "Complaint")",
             data: { ClientID: ClientID },
            success: function (json) {

                var $el = $("#EditProgressStatusId");
                $el.empty(); // remove old options
                $.each(json, function (value, key) {
                    $el.append($("<option></option>").val(key.ID).text(key.Name));
                });


            }
        });
    }
    $("#EditFaulttypeId").change(function () {
        EditLoadFaultTypeDetails();
        EditLoadProgressStatusDetails();
    });
    function EditLoadFaultTypeDetails() {
           var ClientID = $("#EditFaulttypeId").val();
        $.ajax({
            type: "POST",
            url: "@Url.Action("GetFaultTypeDetailList", "Complaint")",
            data: { ClientID: ClientID},
            success: function (json) {

                var $el = $("#EditFaulttypeDetailId");
                $el.empty(); // remove old options
                $.each(json, function (value, key) {
                    $el.append($("<option></option>").val(key.ID).text(key.Name));
                });


            }
        });
    }
    function EditLoadProgressStatusDetails() {
        var ClientID = $("#EditFaulttypeId").val();

        $.ajax({
            type: "POST",
            url: "@Url.Action("GetProgressDetailList", "Complaint")",
            data: { ClientID: ClientID},
            success: function (json) {

                var $el = $("#EditProgressStatusId");
                $el.empty(); // remove old options
                $.each(json, function (value, key) {
                    $el.append($("<option></option>").val(key.ID).text(key.Name));
                });


            }
        });
        }
    $("#EditFaulttypeDetailId").change(function () {
        if ($("#EditFaulttypeDetailId").val() == '3030') {
            $("#EditOtherRemarksBox").show();
        }
        else if ($("#EditFaulttypeDetailId").val() == '3042') {
            $("#EditOtherRemarksBox").show();
        }
        else if ($("#EditFaulttypeDetailId").val() == '3049') {
            $("#EditOtherRemarksBox").show();
        }
        else
        {
            $("#EditOtherRemarksBox").hide();
        }
    });
    $("#EditProgressStatusId").change(function () {
        if ($("#EditProgressStatusId").val() == '2018') {
            $("#EditProgressStatusOtherRemarksBox").show();
        }
        else if ($("#EditProgressStatusId").val() == '2031') {
            $("#EditProgressStatusOtherRemarksBox").show();
        }
        else if ($("#EditProgressStatusId").val() == '2035') {
            $("#EditProgressStatusOtherRemarksBox").show();
        }
        else {
            $("#EditProgressStatusOtherRemarksBox").hide();
        }
    });
    $("#EditStatusID").change(function () {
        if ($("#EditStatusID").val() == '3')
            {
            EditWorkDoneStatusDetails();
            }
            else
            {
            EditLoadProgressStatusDetails();
            }
    });

    //Upload-Picture1 Start
    $('#ChildEditUserImage').click(function () {
        UploadClickEvent();
    });
    $('#EditUploadPicture1').click(function () {
        UploadClickEvent();
    });
    function UploadClickEvent() {
        $('#ChildEditPicture1').trigger('click');
    }
    $('#ChildEditPicture1').change(function () {
        if (this.files && this.files[0]) {
            var fileReader = new FileReader();
            fileReader.readAsDataURL(this.files[0]);
            fileReader.onload = function (x) {
                $('#ChildEditUserImage').attr('src', x.target.result);

            }
        }

    });
    $('#EditRemovePicture1').click(function () {
        $('#ChildEditUserImage').attr('src', "/Images/KSB_Logo_New.jpg");
    });
    //Upload-Picture1 End


    //Upload-Picture2 Start
    $('#ChildEditUserImage2').click(function () {
        $('#ChildEditPicture2').trigger('click');
    });
    $('#EditUploadPicture2').click(function () {
        $('#ChildEditPicture2').trigger('click');
    });
    $('#ChildEditPicture2').change(function () {
        if (this.files && this.files[0]) {
            var fileReader = new FileReader();
            fileReader.readAsDataURL(this.files[0]);
            fileReader.onload = function (x) {
                $('#ChildEditUserImage2').attr('src', x.target.result);

            }
        }

    });
    $('#EditRemovePicture2').click(function () {
        $('#ChildEditUserImage2').attr('src', "/Images/KSB_Logo_New.jpg");
    });
    //Upload-Picture2 End

    //Get Edit Complaint END

      // Post EDIT  Complaint Start
    function PostEditComplaint() {
        var data = new FormData();
        var files = $("#ChildEditPicture1").get(0).files;
        if (files.length > 0) {
            data.append("ChildEditPicture1", files[0]);
        }
        var files2 = $("#ChildEditPicture2").get(0).files;
        if (files2.length > 0) {
            console.log(files2[0]);
            data.append("ChildEditPicture2", files2[0]);
        }
        var RoleID = "@HttpContext.Current.Session["RoleID"]";
        data.append("RoleID", RoleID);
        data.append("JobDetailID", $("#JobDetailID").val());
        data.append("EditComplaintID", $("#EditComplaintID").val());
        data.append("EditFaulttypeId", $("#EditFaulttypeId").val());
        data.append("EditFaulttypeDetailId", $("#EditFaulttypeDetailId").val());
        data.append("EditFaultTypeDetailOtherRemarks", $("#EditFaultTypeDetailOtherRemarks").val());
        data.append("EditPriorityId", $("#EditPriorityId").val());
        data.append("EditComplaintTypeID", $("#EditComplaintTypeID").val());
        data.append("EditSalesOficerID", $("#EditSalesOficerID").val());
        data.append("EditStatusID", $("#EditStatusID").val());
        data.append("EditProgressStatusId", $("#EditProgressStatusId").val());
        data.append("EditProgressStatusOtherRemarks", $("#EditProgressStatusOtherRemarks").val());
        data.append("EditTime", $("#EditTime").val());
        data.append("EditName", $("#EditName").val());
        data.append("EditRemarks", $("#EditRemarks").val());

        $.ajax({
            type: "Post",
            url: "/Home/PostEditComplaint",
            contentType: false,
            processData: false,
            cache: false,
            data: data,
            success: function (result) {
                if (result == true) {
                    $('#EditChildRecord').modal('hide');
                    alertify.success("Complaint Status Edited Successfully.");
                }
                $('#datatab').DataTable().ajax.reload();
            }
        })

    }
    // Post Update Complaint Start END





    function GenerateDetailGrid() {

        var table = $('#datatab').DataTable
            ({
                "aLengthMenu": [[10, 25, 50, 75, 100], [10, 25, 50, 75, 100]],
                "iDisplayLength": 10,
                "lengthChange": false,
                "pagingType": "full_numbers",
                "info": true,
                "serverSide": true,
                "stateSave":true,
                "bRetrieve": true,
                "bDestroy": true,
                "autoWidth": true,
                "ajax":
                {
                    "type": "POST",
                    "url": '@Url.Action("HomeComplaintsDataHandler", "RetailerOrders")',
                    "contentType": 'application/json; charset=utf-8',
                    'data': function (data) {
                        data.StartingDate1 = $('#StartingDate1').val();
                        data.StartingDate2 = $('#StartingDate2').val();
                        data.ProjectId = $('#ProjectId').val();
                        return data = JSON.stringify(data);
                    },
                },
                "fnDrawCallback": function (osetting) {
                    $("#Clear").click(function () {
                        From = $('#StartingDate1').val("");
                        To = $('#StartingDate2').val("");
                        Project = $('#ProjectId').val("");
                        table.clear().draw();
                    });
                    $("#ApplyFilter").click(function () {
                        table.clear().draw();
                    });

        },
                "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                    //$("td:first", nRow).html(iDisplayIndex + 1);
                    if (aData["StatusID"] == "3") {
                        $(nRow).find('td:eq(8)').css('background-color', '#A0B978');
                        $(nRow).find('td:eq(8)').css('color', 'white');

                        // $('td', nRow).css('background-color', 'Green');
                    }
                    if (aData["StatusID"] == "4") {
                        $(nRow).find('td:eq(8)').css('background-color', '#F0E801');
                        $(nRow).find('td:eq(8)').css('color', 'black');

                    }
                    if (aData["ComplaintTypeName"] == "Major") {
                        //$(nRow).find('td:eq(5)').css('background-color', 'red');
                        $(nRow).find('td:eq(4)').css('color', 'red');
                    }
                    if (aData["Exceed"] == "1") {
                        //$(nRow).find('td:eq(5)').css('background-color', 'red');
                        $(nRow).find('td:eq(7)').css('color', 'red');
                    }
                    return nRow;
                },
                "searching": false,
                "processing": true,
                "deferRender": true,
                "bSelect": true,
                "columns": [
                    { "data": "ID", "sClass": "center-align-td", "bVisible": false },
                    { "data": "TicketNo", "sClass": "center-align-td" },
                    { "data": "SiteCode", "sClass": "center-align-td"},
                    { "data": "RetailerName", "sClass": "center-align-td" },
                    { "data": "FaultTypeFinalName", "sClass": "center-align-td" },
                    { "data": "ComplaintTypeName", "sClass": "center-align-td", },
                    { "data": "SaleOfficerName", "sClass": "center-align-td" },
                 
                    {
                        "sClass": "center-align-td",
                        "mData": null,
                        "bSortable": false,
                        "mRender": function (data, type, row)
                        {
                            var RoleID = @HttpContext.Current.Session["RoleID"];
                            {
                                if (RoleID == 1)
                                {
                                    return '<button class="btn bold" style="background-color: #1969b1; color:white; margin-bottom: 5px;" onclick="Detail(' + row.ID + ')">' + 'Detail' + '</button>&nbsp;<button class="btn bold" style="background-color: #1969b1; color:white; margin-bottom: 5px;" onclick="AddRemarks(' + row.ID + ')" >' + 'Remarks' + '</button>&nbsp;<button class="btn Update bold" style="background-color: #1969b1; color:white; margin-bottom: 5px;" ' + 'onclick=ChatBox(' + row.ID + ') >' + ' SMS' + '</button>';

                                }
                                else if (RoleID == 2)
                                {
                                    return '<button class="btn bold" style="background-color: #1969b1; color:white; margin-bottom: 5px;" onclick="Detail(' + row.ID + ')">' + 'Detail' + '</button>&nbsp;<button class="btn bold" style="background-color: #1969b1; color:white; margin-bottom: 5px;" onclick="AddRemarks(' + row.ID + ')" >' + 'Remarks' + '</button>&nbsp;<button class="btn Update bold" style="background-color: #1969b1; color:white; margin-bottom: 5px;" ' + 'onclick=ChatBox(' + row.ID + ') >' + ' SMS' + '</button>&nbsp;<button class="btn bold Update" style="background-color: #1969b1; color:white; margin-bottom: 5px;" ' + 'onclick=UpdateComplaint(' + row.ID + ',' + row.StatusID + ')>' + 'Update' + '</button>';
                                }
                                else if (RoleID == 3)
                                {
                                    return '<button class="btn bold" style="background-color: #1969b1; color:white; margin-bottom: 5px;" onclick="Detail(' + row.ID + ')">' + 'Detail' + '</button>&nbsp;<button class="btn bold" style="background-color: #1969b1; color:white; margin-bottom: 5px;" onclick="AddRemarks(' + row.ID + ')" >' + 'Remarks' + '</button>&nbsp;<button class="btn Update bold" style="background-color: #1969b1; color:white; margin-bottom: 5px;" ' + 'onclick=ChatBox(' + row.ID + ') >' + ' SMS' + '</button>&nbsp;<button class="btn bold Update" style="background-color: #1969b1; color:white; margin-bottom: 5px;" ' + 'onclick=UpdateComplaint(' + row.ID + ',' + row.StatusID + ')>' + 'Update' + '</button>';
                                }
                            }


                        }
                    }
                ], "order": [0, "desc"]

            });

        var interval = setInterval(function () {
            var info = table.page.info();
            var pageNum;
            if (info.end != info.recordsDisplay) {
                pageNum = (info.page < info.pages) ? info.page + 1 : 1;
            }
            else {
                pageNum = 0;
            }
            table.page(pageNum).draw(false);
        }, 30000);

        $('#EndAutoPagination').click(function () {
            clearInterval(interval);
        });
        $('#StartAutoPagination').click(function () {
            setInterval(function () {
                var info = table.page.info();
                var pageNum;
                if (info.end != info.recordsDisplay) {
                    pageNum = (info.page < info.pages) ? info.page + 1 : 1;
                }
                else {
                    pageNum = 0;
                }
                table.page(pageNum).draw(false);
            }, 30000);
        });
    }
    function RemarksDelete(ProgressID) {
        var url = "/Complaint/DeleteRemarksData?ProgressID=" + ProgressID;
        $.ajax({
            type: "GET",
            url: url,
            success: function (Result) {

                if (Result == true) {
                    $('#myModal').modal('hide');
                    $('#datatab').DataTable().ajax.reload();

                    alertify.success("Complaint Remarks Deleted Successfully.");
                }


            }
        })
    }
    function ChildView(ProgressID) {
        var url = "/Complaint/GetProgressIDData?ProgressID=" + ProgressID;
        $("#ViewChildRecord").modal();
        $.ajax({
            type: "GET",
            url: url,
            success: function (Response) {
                $("#ViewChildRecord").css("display", "block");
                $("#ChildViewDateTime").html(Response.DateTime);
                $("#ChildViewFaultTypeFaultTypeDetail").html(Response.FaultTypeFinalName);
                $("#ChildViewComplaintStatus").html(Response.ComplaintStatus);
                if (Response.AssignedFS == null || Response.AssignedFS == "") {
                    $("#ChildViewAssignedFS").html("null");
                }
                else {
                    $("#ChildViewAssignedFS").html(Response.AssignedFS);

                }
                $("#ChildViewProgressStatus").html(Response.ProgressStatusName);
                $("#ChildViewProgressRemarks").html(Response.ProgressRemarks);
                if (Response.Picture1 != null) {
                    $("#ChildViewPicture1").attr('src', Response.Picture1);
                }
                else
                {
                    $("#ChildViewPicture1").attr('src', "/Images/KSB_Logo_New.jpg");
                }
                if (Response.Picture2 != null)
                {
                    $("#ChildViewPicture2").attr('src', Response.Picture2);
                }
                else
                {
                    $("#ChildViewPicture2").attr('src', "/Images/KSB_Logo_New.jpg");
                }



            }
        })
    }
    function ChildDelete(ProgressID) {
        var url = "/Complaint/DeleteProgressIDData?ProgressID=" + ProgressID;
        $.ajax({
            type: "GET",
            url: url,
            success: function (Result) {

                if (Result == true)
                {
                    $('#myModal').modal('hide');
                    $('#datatab').DataTable().ajax.reload();

                alertify.success("Complaint Status Deleted Successfully.");
                }


            }
        })
    }
    function ChildPublish(ProgressID) {
        var url = "/Complaint/ProgressPublish?ProgressID=" + ProgressID;
        $.ajax({
            type: "GET",
            url: url,
            success: function (Result) {

                if (Result == true) {
                    $('#myModal').modal('hide');
                    $('#datatab').DataTable().ajax.reload();

                    alertify.success("Complaint Status Published Successfully.");
                }


            }
        })
    }
    function SendSMS() {
        var data = new FormData();
        var SOID = "@HttpContext.Current.Session["SORelationID"]";
        data.append("SOID", SOID );
        data.append("ComplaintId", $("#SendSMSComplaintId").val());
        data.append("Remarks", $("#ComplaintSMS").val());
        $.ajax({
            type: "Post",
            url: "/Complaint/PostSMS",
            contentType: false,
            processData: false,
            cache: false,
            data: data,
            success: function (result) {

                ChatBox(result);
                $("#ComplaintSMS").val("");
                alertify.success("Message has sent successfully.");

            }
        })

    }
    function ChatBox(ComplaintID) {
        var url = "/Complaint/GetChatBoxData?ComplaintID=" + ComplaintID;
        $("#SendSMSComplaintId").val(ComplaintID);
        $("#ComplaintSMS").val("");
        $("#ChatBoxModel").modal();
        $('html, body').animate({
            scrollTop: $("#main-content").offset().top
        }, 500);
        $.ajax({
            type: "GET",
            url: url,
            success: function (Response)
            {
                $("#GetSMS").empty();
                if (Response.length == 0)
                {
                    $("#ComplaintSMS").val("");
                    $("#SiteNamePlusCode").html("");
                    var divHtml1 = $('<p style="text-align: center">').html("<strong>Not Any Message Found Against This Complaint</strong></p>");
                    $("#GetSMS").append(divHtml1);
                }
                else {
                    $.each(Response, function (i, item) {
                        $("#ComplaintSMS").val("");
                        $("#SiteNamePlusCode").html(item.SiteName);
                        $("#SendSMSComplaintId").val(item.ComplaintID);
                        if (item.SOID == "@HttpContext.Current.Session["SORelationID"]") {
                            var divHtml = $("<div class='MYSMS' Style='float:right;'>").html("<div>" + item.SaleOfficerName + " </br><span style='font-size:12px'> " + item.ShopName + "</span></div><hr style='color:black;margin-top:6px;'><p style='margin-top:5px;'>" + item.Remarks + "</p></div>");
                            $("#GetSMS").append(divHtml);
                        }
                        else
                        {
                            var divHtml = $("<div class='SMS' Style='float:left;'>").html("<div>" + item.SaleOfficerName + "  </br><span style='font-size:12px'>  " + item.ShopName + "</span></div><hr style='color:black;margin-top:6px;'><p style='margin-top:5px;'>" + item.Remarks + "</p></div>");
                            $("#GetSMS").append(divHtml);
                        }

                    });
                }



            }
        })
    }
    function AddRemarks(ComplaintID) {
        $("#AddRemarksModel").modal();
        $("#ComplaintIdAddRemark").val(ComplaintID);
        $('html, body').animate({
            scrollTop: $("#main-content").offset().top
        }, 500);
    }
    function AddRemarksCreate() {
        var data = new FormData();
        data.append("ComplaintId", $("#ComplaintIdAddRemark").val());
        data.append("ClientRemarks", $("#AddRemark").val());
        var settings = {
            type: "Post",
            url: "/Home/SaveClientRemarks",
            contentType: false,
            processData: false,
            cache: false,
            data: data,
            success: function (result) {
                if (result == true) {
                    $('#AddRemarksModel').modal('hide');
                    alertify.success("Remarks Added Successfully.");
                    $("#AddRemark").val("");
                }
                if (result == false) {
                    alertify.error("Remarks Not Added Successfully.");
                }
            }
        };
        $.ajax(settings);
        return false;
    }
    $('#ResetRemarks').click(function () {
        $("#AddRemark").val("");
    });
    function UpdateDateTime() {
        var data = new FormData();
        data.append("UpdateDateTimeComplaintID", $("#UpdateDateTimeComplaintID").val());
        data.append("UpdateDateTime", $("#UpdateDateTime").val());
        var settings = {
            type: "Post",
            url: "/Home/UpdateCompaintDateTime",
            contentType: false,
            processData: false,
            cache: false,
            data: data,
            success: function (result)
            {
                    $('#UpdateComplaintTime').modal('hide');
                    alertify.success("DateTime has Updated Successfully.");
                    $("#UpdateDateTime").val("");
                    $('#datatab').DataTable().ajax.reload();
                     Detail(result);
            }
        };
        $.ajax(settings);
    }
    $('#ResetUpdateDateTime').click(function () {
        $("#UpdateDateTime").val("");
    });


</script>
